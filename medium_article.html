<html>

<head>
    <title data-rh="true">Robust LLM-Driven SQL Query Generation with Substrate.run | by Connor Bell | Exploring Rag and
        Agentic Systems | Aug, 2024 | Medium</title>
    <meta charset="utf-8" data-rh="true" />
    <meta content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1" data-rh="true" name="viewport" />
    <meta content="#000000" data-rh="true" name="theme-color" />
    <meta content="Medium" data-rh="true" name="twitter:app:name:iphone" />
    <meta content="828256236" data-rh="true" name="twitter:app:id:iphone" />
    <meta content="Medium" data-rh="true" property="al:ios:app_name" />
    <meta content="828256236" data-rh="true" property="al:ios:app_store_id" />
    <meta content="com.medium.reader" data-rh="true" property="al:android:package" />
    <meta content="542599432471018" data-rh="true" property="fb:app_id" />
    <meta content="Medium" data-rh="true" property="og:site_name" />
    <meta content="article" data-rh="true" property="og:type" />
    <meta content="2024-08-12T14:05:40.265Z" data-rh="true" property="article:published_time" />
    <meta
        content="Robust LLM-Driven SQL Query Generation with Substrate.run | by Connor Bell | Exploring Rag and Agentic Systems | Aug, 2024 | Medium"
        data-rh="true" name="title" />
    <meta content="Robust LLM-Driven SQL Query Generation with Substrate.run" data-rh="true" property="og:title" />
    <meta content="medium://p/942bab9e54cd" data-rh="true" property="al:android:url" />
    <meta content="medium://p/942bab9e54cd" data-rh="true" property="al:ios:url" />
    <meta content="Medium" data-rh="true" property="al:android:app_name" />
    <meta
        content="In this notebook, I will build a robust Natural-Language to SQL Process using Substrates ComputeJSON() feature. To use this Script all you need is a substrate.run account + api key ($50 in free…"
        data-rh="true" name="description" />
    <meta
        content="In this notebook, I will build a robust Natural-Language to SQL Process using Substrates ComputeJSON() feature."
        data-rh="true" property="og:description" />
    <meta
        content="https://medium.com/exploring-rag-and-agentic-systems/robust-llm-driven-sql-query-generation-with-substrate-run-942bab9e54cd"
        data-rh="true" property="og:url" />
    <meta
        content="https://medium.com/exploring-rag-and-agentic-systems/robust-llm-driven-sql-query-generation-with-substrate-run-942bab9e54cd"
        data-rh="true" property="al:web:url" />
    <meta content="https://miro.medium.com/v2/resize:fit:1200/0*gHGR_yB_PjfpHpe9.jpg" data-rh="true"
        property="og:image" />
    <meta content="https://medium.com/@connor.m.bell13" data-rh="true" property="article:author" />
    <meta content="Connor Bell" data-rh="true" name="author" />
    <meta content="index,noarchive,follow,max-image-preview:large" data-rh="true" name="robots" />
    <meta content="unsafe-url" data-rh="true" name="referrer" />
    <meta content="Robust LLM-Driven SQL Query Generation with Substrate.run" data-rh="true" property="twitter:title" />
    <meta content="@connorbell_dev" data-rh="true" name="twitter:site" />
    <meta content="medium://p/942bab9e54cd" data-rh="true" name="twitter:app:url:iphone" />
    <meta
        content="In this notebook, I will build a robust Natural-Language to SQL Process using Substrates ComputeJSON() feature."
        data-rh="true" property="twitter:description" />
    <meta content="https://miro.medium.com/v2/resize:fit:1200/0*gHGR_yB_PjfpHpe9.jpg" data-rh="true"
        name="twitter:image:src" />
    <meta content="summary_large_image" data-rh="true" name="twitter:card" />
    <meta content="Reading time" data-rh="true" name="twitter:label1" />
    <meta content="5 min read" data-rh="true" name="twitter:data1" />
    <link data-rh="true"
        href="https://miro.medium.com/v2/5d8de952517e8160e40ef9841c781cdc14a5db313057fa3c3de41c6f5b494b19" rel="icon" />
    <link data-rh="true" href="/osd.xml" rel="search" title="Medium" type="application/opensearchdescription+xml" />
    <link data-rh="true"
        href="https://miro.medium.com/v2/resize:fill:304:304/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"
        rel="apple-touch-icon" sizes="152x152" />
    <link data-rh="true"
        href="https://miro.medium.com/v2/resize:fill:240:240/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"
        rel="apple-touch-icon" sizes="120x120" />
    <link data-rh="true"
        href="https://miro.medium.com/v2/resize:fill:152:152/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"
        rel="apple-touch-icon" sizes="76x76" />
    <link data-rh="true"
        href="https://miro.medium.com/v2/resize:fill:120:120/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"
        rel="apple-touch-icon" sizes="60x60" />
    <link color="#171717" data-rh="true"
        href="https://miro.medium.com/v2/resize:fill:1000:1000/7*GAOKVe--MXbEJmV9230oOQ.png" rel="mask-icon" />
    <link crossorigin="" data-rh="true" href="https://glyph.medium.com" rel="preconnect" />
    <link as="style" data-rh="true" href="https://glyph.medium.com/css/unbound.css" id="glyph_preload_link"
        rel="preload" type="text/css" />
    <link data-rh="true" href="https://glyph.medium.com/css/unbound.css" id="glyph_link" rel="stylesheet"
        type="text/css" />
    <link data-rh="true" href="https://medium.com/@connor.m.bell13" rel="author" />
    <link data-rh="true"
        href="https://medium.com/exploring-rag-and-agentic-systems/robust-llm-driven-sql-query-generation-with-substrate-run-942bab9e54cd"
        rel="canonical" />
    <link data-rh="true" href="android-app://com.medium.reader/https/medium.com/p/942bab9e54cd" rel="alternate" />
    <script data-rh="true"
        type="application/ld+json">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:1200\u002F0*gHGR_yB_PjfpHpe9.jpg"],"url":"https:\u002F\u002Fmedium.com\u002Fexploring-rag-and-agentic-systems\u002Frobust-llm-driven-sql-query-generation-with-substrate-run-942bab9e54cd","dateCreated":"2024-08-11T23:27:19.989Z","datePublished":"2024-08-11T23:27:19.989Z","dateModified":"2024-09-17T18:20:49.908Z","headline":"Robust LLM-Driven SQL Query Generation with Substrate.run","name":"Robust LLM-Driven SQL Query Generation with Substrate.run","description":"In this notebook, I will build a robust Natural-Language to SQL Process using Substrates ComputeJSON() feature. To use this Script all you need is a substrate.run account + api key ($50 in free…","identifier":"942bab9e54cd","author":{"@type":"Person","name":"Connor Bell","url":"https:\u002F\u002Fmedium.com\u002F@connor.m.bell13"},"creator":["Connor Bell"],"publisher":{"@type":"Organization","name":"Exploring Rag and Agentic Systems","url":"https:\u002F\u002Fmedium.com\u002Fexploring-rag-and-agentic-systems","logo":{"@type":"ImageObject","width":272,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:544\u002F7*V1_7XP4snlmqrc_0Njontw.png"}},"mainEntityOfPage":"https:\u002F\u002Fmedium.com\u002Fexploring-rag-and-agentic-systems\u002Frobust-llm-driven-sql-query-generation-with-substrate-run-942bab9e54cd"}</script>
    <style data-fela-rehydration="544" data-fela-type="STATIC" type="text/css">
        html {
            box-sizing: border-box;
            -webkit-text-size-adjust: 100%
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit
        }

        body {
            margin: 0;
            padding: 0;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            color: rgba(0, 0, 0, 0.8);
            position: relative;
            min-height: 100vh
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        dl,
        dd,
        ol,
        ul,
        menu,
        figure,
        blockquote,
        p,
        pre,
        form {
            margin: 0
        }

        menu,
        ol,
        ul {
            padding: 0;
            list-style: none;
            list-style-image: none
        }

        main {
            display: block
        }

        a {
            color: inherit;
            text-decoration: none
        }

        a,
        button,
        input {
            -webkit-tap-highlight-color: transparent
        }

        img,
        svg {
            vertical-align: middle
        }

        button {
            background: transparent;
            overflow: visible
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            margin: 0
        }

        :root {
            --reach-tabs: 1;
            --reach-menu-button: 1
        }

        #speechify-root {
            font-family: Sohne, sans-serif
        }

        div[data-popper-reference-hidden="true"] {
            visibility: hidden;
            pointer-events: none
        }

        .grecaptcha-badge {
            visibility: hidden
        }

        /*XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>*/
        .hljs {
            background: #fff;
            color: black;
        }

        /* Gray DOCTYPE selectors like WebKit */
        .xml .hljs-meta {
            color: #c0c0c0;
        }

        .hljs-comment,
        .hljs-quote {
            color: #007400;
        }

        .hljs-tag,
        .hljs-attribute,
        .hljs-keyword,
        .hljs-selector-tag,
        .hljs-literal,
        .hljs-name {
            color: #aa0d91;
        }

        .hljs-variable,
        .hljs-template-variable {
            color: #3F6E74;
        }

        .hljs-code,
        .hljs-string,
        .hljs-meta .hljs-string {
            color: #c41a16;
        }

        .hljs-regexp,
        .hljs-link {
            color: #0E0EFF;
        }

        .hljs-title,
        .hljs-symbol,
        .hljs-bullet,
        .hljs-number {
            color: #1c00cf;
        }

        .hljs-section,
        .hljs-meta {
            color: #643820;
        }

        .hljs-title.class_,
        .hljs-class .hljs-title,
        .hljs-type,
        .hljs-built_in,
        .hljs-params {
            color: #5c2699;
        }

        .hljs-attr {
            color: #836C28;
        }

        .hljs-subst {
            color: #000;
        }

        .hljs-formula {
            background-color: #eee;
            font-style: italic;
        }

        .hljs-addition {
            background-color: #baeeba;
        }

        .hljs-deletion {
            background-color: #ffc8bd;
        }

        .hljs-selector-id,
        .hljs-selector-class {
            color: #9b703f;
        }

        .hljs-doctag,
        .hljs-strong {
            font-weight: bold;
        }

        .hljs-emphasis {
            font-style: italic;
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="KEYFRAME" type="text/css">
        @-webkit-keyframes k1 {
            0% {
                opacity: 0.8
            }

            50% {
                opacity: 0.5
            }

            100% {
                opacity: 0.8
            }
        }

        @-moz-keyframes k1 {
            0% {
                opacity: 0.8
            }

            50% {
                opacity: 0.5
            }

            100% {
                opacity: 0.8
            }
        }

        @keyframes k1 {
            0% {
                opacity: 0.8
            }

            50% {
                opacity: 0.5
            }

            100% {
                opacity: 0.8
            }
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE" type="text/css">
        .a {
            font-family: medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif
        }

        .b {
            font-weight: 400
        }

        .c {
            background-color: rgba(255, 255, 255, 1)
        }

        .l {
            display: block
        }

        .m {
            position: sticky
        }

        .n {
            top: 0
        }

        .o {
            z-index: 500
        }

        .p {
            padding: 0 24px
        }

        .q {
            align-items: center
        }

        .r {
            border-bottom: solid 1px #F2F2F2
        }

        .y {
            height: 41px
        }

        .z {
            line-height: 20px
        }

        .ab {
            display: flex
        }

        .ac {
            height: 57px
        }

        .ae {
            flex: 1 0 auto
        }

        .af {
            color: inherit
        }

        .ag {
            fill: inherit
        }

        .ah {
            font-size: inherit
        }

        .ai {
            border: inherit
        }

        .aj {
            font-family: inherit
        }

        .ak {
            letter-spacing: inherit
        }

        .al {
            font-weight: inherit
        }

        .am {
            padding: 0
        }

        .an {
            margin: 0
        }

        .ao {
            cursor: pointer
        }

        .ap:disabled {
            cursor: not-allowed
        }

        .aq:disabled {
            color: #6B6B6B
        }

        .ar:disabled {
            fill: #6B6B6B
        }

        .au {
            width: auto
        }

        .av path {
            fill: #242424
        }

        .aw {
            height: 25px
        }

        .ax {
            margin-left: 16px
        }

        .ay {
            border: none
        }

        .az {
            border-radius: 20px
        }

        .ba {
            width: 240px
        }

        .bb {
            background: #F9F9F9
        }

        .bc path {
            fill: #6B6B6B
        }

        .be {
            outline: none
        }

        .bf {
            font-family: sohne, "Helvetica Neue", Helvetica, Arial, sans-serif
        }

        .bg {
            font-size: 14px
        }

        .bh {
            width: 100%
        }

        .bi {
            padding: 10px 20px 10px 0
        }

        .bj {
            background-color: transparent
        }

        .bk {
            color: #242424
        }

        .bl::placeholder {
            color: #6B6B6B
        }

        .bm {
            display: inline-block
        }

        .bn {
            margin-left: 12px
        }

        .bo {
            margin-right: 12px
        }

        .bp {
            border-radius: 4px
        }

        .bq {
            margin-left: 24px
        }

        .br {
            height: 24px
        }

        .bx {
            background-color: #F9F9F9
        }

        .by {
            border-radius: 50%
        }

        .bz {
            height: 32px
        }

        .ca {
            width: 32px
        }

        .cb {
            justify-content: center
        }

        .ch {
            max-width: 680px
        }

        .ci {
            min-width: 0
        }

        .cj {
            animation: k1 1.2s ease-in-out infinite
        }

        .ck {
            height: 100vh
        }

        .cl {
            margin-bottom: 16px
        }

        .cm {
            margin-top: 48px
        }

        .cn {
            align-items: flex-start
        }

        .co {
            flex-direction: column
        }

        .cp {
            justify-content: space-between
        }

        .cq {
            margin-bottom: 24px
        }

        .cw {
            width: 80%
        }

        .cx {
            background-color: #F2F2F2
        }

        .dd {
            height: 44px
        }

        .de {
            width: 44px
        }

        .df {
            margin: auto 0
        }

        .dg {
            margin-bottom: 4px
        }

        .dh {
            height: 16px
        }

        .di {
            width: 120px
        }

        .dj {
            width: 80px
        }

        .dp {
            margin-bottom: 8px
        }

        .dq {
            width: 96%
        }

        .dr {
            width: 98%
        }

        .ds {
            width: 81%
        }

        .dt {
            margin-left: 8px
        }

        .du {
            color: #6B6B6B
        }

        .dv {
            font-size: 13px
        }

        .dw {
            height: 100%
        }

        .ep {
            color: #FFFFFF
        }

        .eq {
            fill: #FFFFFF
        }

        .er {
            background: rgba(26, 137, 23, 1)
        }

        .es {
            border-color: rgba(26, 137, 23, 1)
        }

        .ew:disabled {
            cursor: inherit !important
        }

        .ex:disabled {
            opacity: 0.3
        }

        .ey:disabled:hover {
            background: rgba(26, 137, 23, 1)
        }

        .ez:disabled:hover {
            border-color: rgba(26, 137, 23, 1)
        }

        .fa {
            border-radius: 99em
        }

        .fb {
            border-width: 1px
        }

        .fc {
            border-style: solid
        }

        .fd {
            box-sizing: border-box
        }

        .fe {
            text-decoration: none
        }

        .ff {
            text-align: center
        }

        .fi {
            margin-right: 32px
        }

        .fj {
            position: relative
        }

        .fk {
            fill: #6B6B6B
        }

        .fn {
            background: transparent
        }

        .fo svg {
            margin-left: 4px
        }

        .fp svg {
            fill: #6B6B6B
        }

        .fr {
            box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05)
        }

        .fs {
            position: absolute
        }

        .fz {
            margin: 0 24px
        }

        .gd {
            background: rgba(255, 255, 255, 1)
        }

        .ge {
            border: 1px solid #F2F2F2
        }

        .gf {
            box-shadow: 0 1px 4px #F2F2F2
        }

        .gg {
            max-height: 100vh
        }

        .gh {
            overflow-y: auto
        }

        .gi {
            left: 0
        }

        .gj {
            top: calc(100vh + 100px)
        }

        .gk {
            bottom: calc(100vh + 100px)
        }

        .gl {
            width: 10px
        }

        .gm {
            pointer-events: none
        }

        .gn {
            word-break: break-word
        }

        .go {
            word-wrap: break-word
        }

        .gp:after {
            display: block
        }

        .gq:after {
            content: ""
        }

        .gr:after {
            clear: both
        }

        .gs {
            line-height: 1.23
        }

        .gt {
            letter-spacing: 0
        }

        .gu {
            font-style: normal
        }

        .gv {
            font-weight: 700
        }

        .ia {
            align-items: baseline
        }

        .ib {
            width: 48px
        }

        .ic {
            height: 48px
        }

        .id {
            border: 2px solid rgba(255, 255, 255, 1)
        }

        .ie {
            z-index: 0
        }

        .if {
            box-shadow: none
        }

        .ig {
            border: 1px solid rgba(0, 0, 0, 0.05)
        }

        .ih {
            margin-left: -12px
        }

        .ii {
            width: 28px
        }

        .ij {
            height: 28px
        }

        .ik {
            z-index: 1
        }

        .il {
            width: 24px
        }

        .im {
            margin-bottom: 2px
        }

        .in {
            flex-wrap: nowrap
        }

        .io {
            font-size: 16px
        }

        .ip {
            line-height: 24px
        }

        .ir {
            margin: 0 8px
        }

        .is {
            display: inline
        }

        .it {
            color: rgba(26, 137, 23, 1)
        }

        .iu {
            fill: rgba(26, 137, 23, 1)
        }

        .ix {
            flex: 0 0 auto
        }

        .ja {
            flex-wrap: wrap
        }

        .jd {
            white-space: pre-wrap
        }

        .je {
            margin-right: 4px
        }

        .jf {
            overflow: hidden
        }

        .jg {
            max-height: 20px
        }

        .jh {
            text-overflow: ellipsis
        }

        .ji {
            display: -webkit-box
        }

        .jj {
            -webkit-line-clamp: 1
        }

        .jk {
            -webkit-box-orient: vertical
        }

        .jl {
            word-break: break-all
        }

        .jn {
            padding-left: 8px
        }

        .jo {
            padding-right: 8px
        }

        .kp>* {
            flex-shrink: 0
        }

        .kq {
            overflow-x: scroll
        }

        .kr::-webkit-scrollbar {
            display: none
        }

        .ks {
            scrollbar-width: none
        }

        .kt {
            -ms-overflow-style: none
        }

        .ku {
            width: 74px
        }

        .kv {
            flex-direction: row
        }

        .kw {
            z-index: 2
        }

        .kz {
            -webkit-user-select: none
        }

        .la {
            border: 0
        }

        .lb {
            fill: rgba(117, 117, 117, 1)
        }

        .le {
            outline: 0
        }

        .lf {
            user-select: none
        }

        .lg>svg {
            pointer-events: none
        }

        .lp {
            cursor: progress
        }

        .lq {
            opacity: 1
        }

        .lr {
            padding: 4px 0
        }

        .lu {
            margin-top: 0px
        }

        .lv {
            width: 16px
        }

        .lx {
            display: inline-flex
        }

        .md {
            max-width: 100%
        }

        .me {
            padding: 8px 2px
        }

        .mf svg {
            color: #6B6B6B
        }

        .mw {
            margin-left: auto
        }

        .mx {
            margin-right: auto
        }

        .my {
            max-width: 1200px
        }

        .ne {
            clear: both
        }

        .ng {
            cursor: zoom-in
        }

        .nh {
            z-index: auto
        }

        .nj {
            height: auto
        }

        .nk {
            line-height: 1.58
        }

        .nl {
            letter-spacing: -0.004em
        }

        .nm {
            font-family: source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif
        }

        .oh {
            margin-bottom: -0.46em
        }

        .oi {
            padding: 2px 4px
        }

        .oj {
            font-size: 75%
        }

        .ok>strong {
            font-family: inherit
        }

        .ol {
            font-family: source-code-pro, Menlo, Monaco, "Courier New", Courier, monospace
        }

        .om {
            text-decoration: underline
        }

        .on {
            list-style-type: disc
        }

        .oo {
            margin-left: 30px
        }

        .op {
            padding-left: 0px
        }

        .ov {
            line-height: 1.18
        }

        .ow {
            letter-spacing: -0.022em
        }

        .ox {
            font-weight: 600
        }

        .pn {
            margin-bottom: -0.31em
        }

        .po {
            max-width: 1145px
        }

        .pu {
            line-height: 1.12
        }

        .qn {
            margin-bottom: -0.28em
        }

        .qt {
            overflow-x: auto
        }

        .qu {
            padding: 32px
        }

        .qv {
            border: 1px solid #E5E5E5
        }

        .qw {
            line-height: 1.4
        }

        .qx {
            margin-top: -0.2em
        }

        .qy {
            margin-bottom: -0.2em
        }

        .qz {
            white-space: pre
        }

        .ra {
            min-width: fit-content
        }

        .rb {
            box-shadow: inset 3px 0 0 0 #242424
        }

        .rc {
            padding-left: 23px
        }

        .rd {
            margin-left: -20px
        }

        .re {
            font-style: italic
        }

        .rf {
            list-style-type: decimal
        }

        .rg {
            margin-bottom: 26px
        }

        .rh {
            margin-top: 6px
        }

        .ri {
            margin-top: 8px
        }

        .rj {
            margin-right: 8px
        }

        .rk {
            padding: 8px 16px
        }

        .rl {
            border-radius: 100px
        }

        .rm {
            transition: background 300ms ease
        }

        .ro {
            white-space: nowrap
        }

        .rp {
            border-top: none
        }

        .rv {
            height: 52px
        }

        .rw {
            max-height: 52px
        }

        .rx {
            box-sizing: content-box
        }

        .ry {
            position: static
        }

        .sa {
            max-width: 155px
        }

        .sg {
            margin-right: 20px
        }

        .sm {
            align-items: flex-end
        }

        .sn {
            width: 76px
        }

        .so {
            height: 76px
        }

        .sp {
            border: 2px solid #F9F9F9
        }

        .sq {
            height: 72px
        }

        .sr {
            width: 72px
        }

        .ss {
            margin-left: -16px
        }

        .st {
            width: 36px
        }

        .su {
            height: 36px
        }

        .sv {
            color: rgba(255, 255, 255, 1)
        }

        .sw {
            fill: rgba(255, 255, 255, 1)
        }

        .sx {
            background: rgba(25, 25, 25, 1)
        }

        .sy {
            border-color: rgba(25, 25, 25, 1)
        }

        .tb:disabled {
            opacity: 0.1
        }

        .tc:disabled:hover {
            background: rgba(25, 25, 25, 1)
        }

        .td:disabled:hover {
            border-color: rgba(25, 25, 25, 1)
        }

        .te {
            stroke: #F2F2F2
        }

        .tf {
            color: #F2F2F2
        }

        .tg {
            fill: #F2F2F2
        }

        .th {
            background: #F2F2F2
        }

        .ti {
            border-color: #F2F2F2
        }

        .to {
            font-weight: 500
        }

        .tp {
            font-size: 24px
        }

        .tq {
            line-height: 30px
        }

        .tr {
            letter-spacing: -0.016em
        }

        .ts {
            margin-top: 16px
        }

        .tt {
            height: 0px
        }

        .tu {
            border-bottom: solid 1px #E5E5E5
        }

        .tv {
            margin-top: 72px
        }

        .tw {
            padding: 24px 0
        }

        .tx {
            margin-bottom: 0px
        }

        .ty {
            margin-right: 16px
        }

        .as:hover:not(:disabled) {
            color: rgba(25, 25, 25, 1)
        }

        .at:hover:not(:disabled) {
            fill: rgba(25, 25, 25, 1)
        }

        .et:hover {
            background: rgba(15, 115, 12, 1)
        }

        .eu:hover {
            border-color: rgba(15, 115, 12, 1)
        }

        .ev:hover {
            cursor: pointer
        }

        .fl:hover {
            color: #242424
        }

        .fm:hover {
            fill: #242424
        }

        .fq:hover svg {
            fill: #242424
        }

        .ft:hover {
            background-color: rgba(0, 0, 0, 0.1)
        }

        .iq:hover {
            text-decoration: underline
        }

        .iv:hover:not(:disabled) {
            color: rgba(15, 115, 12, 1)
        }

        .iw:hover:not(:disabled) {
            fill: rgba(15, 115, 12, 1)
        }

        .ld:hover {
            fill: rgba(8, 8, 8, 1)
        }

        .ls:hover {
            fill: #000000
        }

        .lt:hover p {
            color: #000000
        }

        .lw:hover {
            color: #000000
        }

        .mg:hover svg {
            color: #000000
        }

        .rn:hover {
            background-color: #F2F2F2
        }

        .sz:hover {
            background: #000000
        }

        .ta:hover {
            border-color: #242424
        }

        .tj:hover {
            background: #F2F2F2
        }

        .tk:hover {
            border-color: #F2F2F2
        }

        .tl:hover {
            cursor: wait
        }

        .tm:hover {
            color: #F2F2F2
        }

        .tn:hover {
            fill: #F2F2F2
        }

        .bd:focus-within path {
            fill: #242424
        }

        .lc:focus {
            fill: rgba(8, 8, 8, 1)
        }

        .mh:focus svg {
            color: #000000
        }

        .ni:focus {
            transform: scale(1.01)
        }

        .lh:active {
            border-style: none
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE" media="all and (min-width: 1080px)" type="text/css">
        .d {
            display: none
        }

        .bw {
            width: 64px
        }

        .cg {
            margin: 0 64px
        }

        .cv {
            height: 48px
        }

        .dc {
            margin-bottom: 52px
        }

        .do {
            margin-bottom: 48px
        }

        .ef {
            font-size: 14px
        }

        .eg {
            line-height: 20px
        }

        .em {
            font-size: 13px
        }

        .eo {
            padding: 5px 12px
        }

        .fh {
            display: flex
        }

        .fy {
            margin-bottom: 68px
        }

        .gc {
            max-width: 680px
        }

        .hq {
            font-size: 42px
        }

        .hr {
            margin-top: 1.19em
        }

        .hs {
            margin-bottom: 32px
        }

        .ht {
            line-height: 52px
        }

        .hu {
            letter-spacing: -0.011em
        }

        .hz {
            align-items: center
        }

        .kb {
            border-top: solid 1px #F2F2F2
        }

        .kc {
            border-bottom: solid 1px #F2F2F2
        }

        .kd {
            margin: 32px 0 0
        }

        .ke {
            padding: 3px 8px
        }

        .kn>* {
            margin-right: 24px
        }

        .ko> :last-child {
            margin-right: 0
        }

        .lo {
            margin-top: 0px
        }

        .mc {
            margin: 0
        }

        .nd {
            margin-top: 40px
        }

        .od {
            font-size: 20px
        }

        .oe {
            margin-top: 2.14em
        }

        .of {
            line-height: 32px
        }

        .og {
            letter-spacing: -0.003em
        }

        .ou {
            margin-top: 1.14em
        }

        .pk {
            margin-top: 1.72em
        }

        .pl {
            line-height: 24px
        }

        .pm {
            letter-spacing: 0
        }

        .pt {
            margin-top: 56px
        }

        .qj {
            font-size: 24px
        }

        .qk {
            margin-top: 1.95em
        }

        .ql {
            line-height: 30px
        }

        .qm {
            letter-spacing: -0.016em
        }

        .qs {
            margin-top: 0.94em
        }

        .ru {
            margin-bottom: 88px
        }

        .sf {
            display: inline-block
        }

        .sl {
            padding-top: 72px
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE" media="all and (max-width: 1079.98px)" type="text/css">
        .e {
            display: none
        }

        .ln {
            margin-top: 0px
        }

        .se {
            display: inline-block
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE" media="all and (max-width: 903.98px)" type="text/css">
        .f {
            display: none
        }

        .lm {
            margin-top: 0px
        }

        .sd {
            display: inline-block
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE" media="all and (max-width: 727.98px)" type="text/css">
        .g {
            display: none
        }

        .lk {
            margin-top: 0px
        }

        .ll {
            margin-right: 0px
        }

        .sc {
            display: inline-block
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE" media="all and (max-width: 551.98px)" type="text/css">
        .h {
            display: none
        }

        .s {
            display: flex
        }

        .t {
            justify-content: space-between
        }

        .bs {
            width: 24px
        }

        .cc {
            margin: 0 24px
        }

        .cr {
            height: 40px
        }

        .cy {
            margin-bottom: 44px
        }

        .dk {
            margin-bottom: 32px
        }

        .dx {
            font-size: 13px
        }

        .dy {
            line-height: 20px
        }

        .eh {
            padding: 0px 8px 1px
        }

        .fu {
            margin-bottom: 4px
        }

        .gw {
            font-size: 32px
        }

        .gx {
            margin-top: 1.01em
        }

        .gy {
            margin-bottom: 24px
        }

        .gz {
            line-height: 38px
        }

        .ha {
            letter-spacing: -0.014em
        }

        .hv {
            align-items: flex-start
        }

        .iy {
            flex-direction: column
        }

        .jb {
            margin-bottom: 2px
        }

        .jp {
            margin: 24px -24px 0
        }

        .jq {
            padding: 0
        }

        .kf>* {
            margin-right: 8px
        }

        .kg> :last-child {
            margin-right: 24px
        }

        .kx {
            margin-left: 0px
        }

        .li {
            margin-top: 0px
        }

        .lj {
            margin-right: 0px
        }

        .ly {
            margin: 0
        }

        .mi {
            border: 1px solid #F2F2F2
        }

        .mj {
            border-radius: 99em
        }

        .mk {
            padding: 0px 16px 0px 12px
        }

        .ml {
            height: 38px
        }

        .mm {
            align-items: center
        }

        .mo svg {
            margin-right: 8px
        }

        .mz {
            margin-top: 32px
        }

        .nn {
            font-size: 18px
        }

        .no {
            margin-top: 1.56em
        }

        .np {
            line-height: 28px
        }

        .nq {
            letter-spacing: -0.003em
        }

        .oq {
            margin-top: 1.34em
        }

        .oy {
            font-size: 16px
        }

        .oz {
            margin-top: 1.23em
        }

        .pa {
            letter-spacing: 0
        }

        .pp {
            margin-top: 40px
        }

        .pv {
            font-size: 20px
        }

        .pw {
            margin-top: 1.2em
        }

        .px {
            line-height: 24px
        }

        .qo {
            margin-top: 0.67em
        }

        .rq {
            margin-bottom: 80px
        }

        .sb {
            display: inline-block
        }

        .sh {
            padding-top: 48px
        }

        .mn:hover {
            border-color: #E5E5E5
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE"
        media="all and (min-width: 904px) and (max-width: 1079.98px)" type="text/css">
        .i {
            display: none
        }

        .bv {
            width: 64px
        }

        .cf {
            margin: 0 64px
        }

        .cu {
            height: 48px
        }

        .db {
            margin-bottom: 52px
        }

        .dn {
            margin-bottom: 48px
        }

        .ed {
            font-size: 14px
        }

        .ee {
            line-height: 20px
        }

        .ek {
            font-size: 13px
        }

        .el {
            padding: 5px 12px
        }

        .fg {
            display: flex
        }

        .fx {
            margin-bottom: 68px
        }

        .gb {
            max-width: 680px
        }

        .hl {
            font-size: 42px
        }

        .hm {
            margin-top: 1.19em
        }

        .hn {
            margin-bottom: 32px
        }

        .ho {
            line-height: 52px
        }

        .hp {
            letter-spacing: -0.011em
        }

        .hy {
            align-items: center
        }

        .jx {
            border-top: solid 1px #F2F2F2
        }

        .jy {
            border-bottom: solid 1px #F2F2F2
        }

        .jz {
            margin: 32px 0 0
        }

        .ka {
            padding: 3px 8px
        }

        .kl>* {
            margin-right: 24px
        }

        .km> :last-child {
            margin-right: 0
        }

        .mb {
            margin: 0
        }

        .nc {
            margin-top: 40px
        }

        .nz {
            font-size: 20px
        }

        .oa {
            margin-top: 2.14em
        }

        .ob {
            line-height: 32px
        }

        .oc {
            letter-spacing: -0.003em
        }

        .ot {
            margin-top: 1.14em
        }

        .ph {
            margin-top: 1.72em
        }

        .pi {
            line-height: 24px
        }

        .pj {
            letter-spacing: 0
        }

        .ps {
            margin-top: 56px
        }

        .qf {
            font-size: 24px
        }

        .qg {
            margin-top: 1.95em
        }

        .qh {
            line-height: 30px
        }

        .qi {
            letter-spacing: -0.016em
        }

        .qr {
            margin-top: 0.94em
        }

        .rt {
            margin-bottom: 88px
        }

        .sk {
            padding-top: 72px
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE"
        media="all and (min-width: 728px) and (max-width: 903.98px)" type="text/css">
        .j {
            display: none
        }

        .w {
            display: flex
        }

        .x {
            justify-content: space-between
        }

        .bu {
            width: 64px
        }

        .ce {
            margin: 0 48px
        }

        .ct {
            height: 48px
        }

        .da {
            margin-bottom: 52px
        }

        .dm {
            margin-bottom: 48px
        }

        .eb {
            font-size: 13px
        }

        .ec {
            line-height: 20px
        }

        .ej {
            padding: 0px 8px 1px
        }

        .fw {
            margin-bottom: 68px
        }

        .ga {
            max-width: 680px
        }

        .hg {
            font-size: 42px
        }

        .hh {
            margin-top: 1.19em
        }

        .hi {
            margin-bottom: 32px
        }

        .hj {
            line-height: 52px
        }

        .hk {
            letter-spacing: -0.011em
        }

        .hx {
            align-items: center
        }

        .jt {
            border-top: solid 1px #F2F2F2
        }

        .ju {
            border-bottom: solid 1px #F2F2F2
        }

        .jv {
            margin: 32px 0 0
        }

        .jw {
            padding: 3px 8px
        }

        .kj>* {
            margin-right: 24px
        }

        .kk> :last-child {
            margin-right: 0
        }

        .ma {
            margin: 0
        }

        .nb {
            margin-top: 40px
        }

        .nv {
            font-size: 20px
        }

        .nw {
            margin-top: 2.14em
        }

        .nx {
            line-height: 32px
        }

        .ny {
            letter-spacing: -0.003em
        }

        .os {
            margin-top: 1.14em
        }

        .pe {
            margin-top: 1.72em
        }

        .pf {
            line-height: 24px
        }

        .pg {
            letter-spacing: 0
        }

        .pr {
            margin-top: 56px
        }

        .qb {
            font-size: 24px
        }

        .qc {
            margin-top: 1.95em
        }

        .qd {
            line-height: 30px
        }

        .qe {
            letter-spacing: -0.016em
        }

        .qq {
            margin-top: 0.94em
        }

        .rs {
            margin-bottom: 88px
        }

        .sj {
            padding-top: 72px
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE"
        media="all and (min-width: 552px) and (max-width: 727.98px)" type="text/css">
        .k {
            display: none
        }

        .u {
            display: flex
        }

        .v {
            justify-content: space-between
        }

        .bt {
            width: 24px
        }

        .cd {
            margin: 0 24px
        }

        .cs {
            height: 40px
        }

        .cz {
            margin-bottom: 44px
        }

        .dl {
            margin-bottom: 32px
        }

        .dz {
            font-size: 13px
        }

        .ea {
            line-height: 20px
        }

        .ei {
            padding: 0px 8px 1px
        }

        .fv {
            margin-bottom: 4px
        }

        .hb {
            font-size: 32px
        }

        .hc {
            margin-top: 1.01em
        }

        .hd {
            margin-bottom: 24px
        }

        .he {
            line-height: 38px
        }

        .hf {
            letter-spacing: -0.014em
        }

        .hw {
            align-items: flex-start
        }

        .iz {
            flex-direction: column
        }

        .jc {
            margin-bottom: 2px
        }

        .jr {
            margin: 24px 0 0
        }

        .js {
            padding: 0
        }

        .kh>* {
            margin-right: 8px
        }

        .ki> :last-child {
            margin-right: 8px
        }

        .ky {
            margin-left: 0px
        }

        .lz {
            margin: 0
        }

        .mp {
            border: 1px solid #F2F2F2
        }

        .mq {
            border-radius: 99em
        }

        .mr {
            padding: 0px 16px 0px 12px
        }

        .ms {
            height: 38px
        }

        .mt {
            align-items: center
        }

        .mv svg {
            margin-right: 8px
        }

        .na {
            margin-top: 32px
        }

        .nr {
            font-size: 18px
        }

        .ns {
            margin-top: 1.56em
        }

        .nt {
            line-height: 28px
        }

        .nu {
            letter-spacing: -0.003em
        }

        .or {
            margin-top: 1.34em
        }

        .pb {
            font-size: 16px
        }

        .pc {
            margin-top: 1.23em
        }

        .pd {
            letter-spacing: 0
        }

        .pq {
            margin-top: 40px
        }

        .py {
            font-size: 20px
        }

        .pz {
            margin-top: 1.2em
        }

        .qa {
            line-height: 24px
        }

        .qp {
            margin-top: 0.67em
        }

        .rr {
            margin-bottom: 80px
        }

        .si {
            padding-top: 48px
        }

        .mu:hover {
            border-color: #E5E5E5
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE" media="print" type="text/css">
        .rz {
            display: none
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE" media="(orientation: landscape) and (max-width: 903.98px)"
        type="text/css">
        .jm {
            max-height: none
        }
    </style>
    <style data-fela-rehydration="544" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)"
        type="text/css">
        .nf {
            transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1)
        }
    </style>
</head>

<body>
    <article>
        <div class="l">
            <div class="l"><span class="l"></span>
                <section>
                    <div>
                        <div class="fs gi gj gk gl gm"></div>
                        <div class="gn go gp gq gr">
                            <div class="ab cb">
                                <div class="ci bh fz ga gb gc">
                                    <div>
                                        <h1 class="pw-post-title gs gt gu bf gv gw gx gy gz ha hb hc hd he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu bk"
                                            data-testid="storyTitle" id="a397">Robust LLM-Driven SQL Query Generation
                                            with Substrate.run</h1>
                                        <div>
                                            <div class="speechify-ignore ab cp">
                                                <div class="speechify-ignore bh l">
                                                    <div class="hv hw hx hy hz ab">
                                                        <div>
                                                            <div class="ab ia"><a
                                                                    href="/@connor.m.bell13?source=post_page-----942bab9e54cd--------------------------------"
                                                                    rel="noopener follow">
                                                                    <div>
                                                                        <div aria-hidden="false" class="bm">
                                                                            <div class="l ib ic by id ie">
                                                                                <div class="l fj"><img alt="Connor Bell"
                                                                                        class="l fd by dd de cx"
                                                                                        data-testid="authorPhoto"
                                                                                        height="44" loading="lazy"
                                                                                        src="https://miro.medium.com/v2/resize:fill:88:88/1*pxzbUBuD6SLioLMxcVfGUQ@2x.jpeg"
                                                                                        width="44" />
                                                                                    <div
                                                                                        class="if by l dd de fs n ig ft">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </a><a
                                                                    href="https://medium.com/exploring-rag-and-agentic-systems?source=post_page-----942bab9e54cd--------------------------------"
                                                                    rel="noopener follow">
                                                                    <div class="ih ab fj">
                                                                        <div>
                                                                            <div aria-hidden="false" class="bm">
                                                                                <div class="l ii ij by id ik">
                                                                                    <div class="l fj"><img
                                                                                            alt="Exploring Rag and Agentic Systems"
                                                                                            class="l fd by br il cx"
                                                                                            data-testid="publicationPhoto"
                                                                                            height="24" loading="lazy"
                                                                                            src="https://miro.medium.com/v2/resize:fill:48:48/1*nvdaABCn-48k83YQ-5sh9w.jpeg"
                                                                                            width="24" />
                                                                                        <div
                                                                                            class="if by l br il fs n ig ft">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </a></div>
                                                        </div>
                                                        <div class="bn bh l">
                                                            <div class="ab">
                                                                <div style="flex:1"><span class="bf b bg z bk">
                                                                        <div class="im ab q">
                                                                            <div class="ab q in">
                                                                                <div class="ab q">
                                                                                    <div>
                                                                                        <div aria-hidden="false"
                                                                                            class="bm">
                                                                                            <p class="bf b io ip bk"><a
                                                                                                    class="af ag ah ai aj ak al am an ao ap aq ar iq"
                                                                                                    data-testid="authorName"
                                                                                                    href="/@connor.m.bell13?source=post_page-----942bab9e54cd--------------------------------"
                                                                                                    rel="noopener follow">Connor
                                                                                                    Bell</a></p>
                                                                                        </div>
                                                                                    </div>
                                                                                </div><span aria-hidden="true"
                                                                                    class="ir is"><span
                                                                                        class="bf b bg z du">·</span></span>
                                                                                <p class="bf b io ip du"><span><a
                                                                                            class="it iu ah ai aj ak al am an ao ap aq ar ex iv iw"
                                                                                            href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff9df7ac9cadf&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fexploring-rag-and-agentic-systems%2Frobust-llm-driven-sql-query-generation-with-substrate-run-942bab9e54cd&amp;user=Connor+Bell&amp;userId=f9df7ac9cadf&amp;source=post_page-f9df7ac9cadf----942bab9e54cd---------------------post_header-----------"
                                                                                            rel="noopener follow">Follow</a></span>
                                                                                </p>
                                                                            </div>
                                                                        </div>
                                                                    </span></div>
                                                            </div>
                                                            <div class="l ix"><span class="bf b bg z du">
                                                                    <div class="ab cn iy iz ja">
                                                                        <div class="jb jc ab">
                                                                            <div class="bf b bg z du ab jd"><span
                                                                                    class="je l ix">Published in</span>
                                                                                <div>
                                                                                    <div aria-hidden="false" class="l">
                                                                                        <a class="af ag ah ai aj ak al am an ao ap aq ar iq ab q"
                                                                                            data-testid="publicationName"
                                                                                            href="https://medium.com/exploring-rag-and-agentic-systems?source=post_page-----942bab9e54cd--------------------------------"
                                                                                            rel="noopener follow">
                                                                                            <p
                                                                                                class="bf b bg z jf jg jh ji jj jk jl jm bk">
                                                                                                Exploring Rag and
                                                                                                Agentic Systems</p>
                                                                                        </a>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="h k"><span aria-hidden="true"
                                                                                    class="ir is"><span
                                                                                        class="bf b bg z du">·</span></span>
                                                                            </div>
                                                                        </div><span class="bf b bg z du">
                                                                            <div class="ab ae"><span
                                                                                    data-testid="storyReadTime">5 min
                                                                                    read</span>
                                                                                <div aria-hidden="true" class="jn jo l">
                                                                                    <span aria-hidden="true"
                                                                                        class="l"><span
                                                                                            class="bf b bg z du">·</span></span>
                                                                                </div><span
                                                                                    data-testid="storyPublishDate">Aug
                                                                                    11, 2024</span>
                                                                            </div>
                                                                        </span>
                                                                    </div>
                                                                </span></div>
                                                        </div>
                                                    </div>
                                                    <div class="ab cp jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke">
                                                        <div class="h k w fg fh q">
                                                            <div class="ku l">
                                                                <div class="ab q kv kw">
                                                                    <div class="pw-multi-vote-icon fj je kx ky kz">
                                                                        <span><a class="af ag ah ai aj ak al am an ao ap aq ar as at"
                                                                                data-testid="headerClapButton"
                                                                                href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fexploring-rag-and-agentic-systems%2F942bab9e54cd&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fexploring-rag-and-agentic-systems%2Frobust-llm-driven-sql-query-generation-with-substrate-run-942bab9e54cd&amp;user=Connor+Bell&amp;userId=f9df7ac9cadf&amp;source=-----942bab9e54cd---------------------clap_footer-----------"
                                                                                rel="noopener follow">
                                                                                <div>
                                                                                    <div aria-hidden="false" class="bm">
                                                                                        <div
                                                                                            class="la ao lb lc ld le am lf lg lh kz">
                                                                                            <svg aria-label="clap"
                                                                                                height="24"
                                                                                                viewbox="0 0 24 24"
                                                                                                width="24"
                                                                                                xmlns="http://www.w3.org/2000/svg">
                                                                                                <path
                                                                                                    clip-rule="evenodd"
                                                                                                    d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z"
                                                                                                    fill-rule="evenodd">
                                                                                                </path>
                                                                                            </svg>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </a></span>
                                                                    </div>
                                                                    <div
                                                                        class="pw-multi-vote-count l li lj lk ll lm ln lo">
                                                                        <p class="bf b dv z du"><span
                                                                                class="lp">--</span></p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div aria-hidden="false" class="bm"><button
                                                                        aria-label="responses"
                                                                        class="ao la lq lr ab q fk ls lt"><svg
                                                                            class="lu" height="24" viewbox="0 0 24 24"
                                                                            width="24"
                                                                            xmlns="http://www.w3.org/2000/svg">
                                                                            <path
                                                                                d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z">
                                                                            </path>
                                                                        </svg></button></div>
                                                            </div>
                                                        </div>
                                                        <div class="ab q kf kg kh ki kj kk kl km kn ko kp kq kr ks kt">
                                                            <div class="lv k j i d"></div>
                                                            <div class="h k">
                                                                <div>
                                                                    <div aria-hidden="false" class="bm"><span><a
                                                                                class="af ag ah ai aj ak al am an ao ap aq ar as at"
                                                                                data-testid="headerBookmarkButton"
                                                                                href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F942bab9e54cd&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fexploring-rag-and-agentic-systems%2Frobust-llm-driven-sql-query-generation-with-substrate-run-942bab9e54cd&amp;source=-----942bab9e54cd---------------------bookmark_footer-----------"
                                                                                rel="noopener follow"><svg
                                                                                    aria-label="Add to list bookmark button"
                                                                                    class="du lw" fill="none"
                                                                                    height="25" viewbox="0 0 25 25"
                                                                                    width="25"
                                                                                    xmlns="http://www.w3.org/2000/svg">
                                                                                    <path
                                                                                        d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"
                                                                                        fill="currentColor"></path>
                                                                                </svg></a></span></div>
                                                                </div>
                                                            </div>
                                                            <div class="fd lx cn">
                                                                <div class="l ae">
                                                                    <div class="ab cb">
                                                                        <div class="ly lz ma mb mc md ci bh">
                                                                            <div class="ab">
                                                                                <div aria-hidden="false" class="bm bh">
                                                                                    <div>
                                                                                        <div aria-hidden="false"
                                                                                            class="bm"><button
                                                                                                aria-label="Listen"
                                                                                                class="af fk ah ai aj ak al me an ao ap ex mf mg lt mh mi mj mk ml s mm mn mo mp mq mr ms u mt mu mv"
                                                                                                data-testid="audioPlayButton"><svg
                                                                                                    fill="none"
                                                                                                    height="24"
                                                                                                    viewbox="0 0 24 24"
                                                                                                    width="24"
                                                                                                    xmlns="http://www.w3.org/2000/svg">
                                                                                                    <path
                                                                                                        clip-rule="evenodd"
                                                                                                        d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832"
                                                                                                        fill="currentColor"
                                                                                                        fill-rule="evenodd">
                                                                                                    </path>
                                                                                                </svg>
                                                                                                <div class="j i d">
                                                                                                    <p
                                                                                                        class="bf b bg z du">
                                                                                                        Listen</p>
                                                                                                </div>
                                                                                            </button></div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div aria-describedby="postFooterSocialMenu"
                                                                aria-hidden="false"
                                                                aria-labelledby="postFooterSocialMenu" class="bm">
                                                                <div>
                                                                    <div aria-hidden="false" class="bm"><button
                                                                            aria-controls="postFooterSocialMenu"
                                                                            aria-expanded="false"
                                                                            aria-label="Share Post"
                                                                            class="af fk ah ai aj ak al me an ao ap ex mf mg lt mh mi mj mk ml s mm mn mo mp mq mr ms u mt mu mv"
                                                                            data-testid="headerSocialShareButton"><svg
                                                                                fill="none" height="24"
                                                                                viewbox="0 0 24 24" width="24"
                                                                                xmlns="http://www.w3.org/2000/svg">
                                                                                <path clip-rule="evenodd"
                                                                                    d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1"
                                                                                    fill="currentColor"
                                                                                    fill-rule="evenodd"></path>
                                                                            </svg>
                                                                            <div class="j i d">
                                                                                <p class="bf b bg z du">Share</p>
                                                                            </div>
                                                                        </button></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <figure class="mz na nb nc nd ne mw mx paragraph-image">
                                        <div class="nf ng fj nh bh ni" role="button" tabindex="0">
                                            <div class="mw mx my">
                                                <picture>
                                                    <source
                                                        sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"
                                                        srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*gHGR_yB_PjfpHpe9.jpg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*gHGR_yB_PjfpHpe9.jpg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*gHGR_yB_PjfpHpe9.jpg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*gHGR_yB_PjfpHpe9.jpg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*gHGR_yB_PjfpHpe9.jpg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*gHGR_yB_PjfpHpe9.jpg 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gHGR_yB_PjfpHpe9.jpg 1400w"
                                                        type="image/webp" />
                                                    <source data-testid="og"
                                                        sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"
                                                        srcset="https://miro.medium.com/v2/resize:fit:640/0*gHGR_yB_PjfpHpe9.jpg 640w, https://miro.medium.com/v2/resize:fit:720/0*gHGR_yB_PjfpHpe9.jpg 720w, https://miro.medium.com/v2/resize:fit:750/0*gHGR_yB_PjfpHpe9.jpg 750w, https://miro.medium.com/v2/resize:fit:786/0*gHGR_yB_PjfpHpe9.jpg 786w, https://miro.medium.com/v2/resize:fit:828/0*gHGR_yB_PjfpHpe9.jpg 828w, https://miro.medium.com/v2/resize:fit:1100/0*gHGR_yB_PjfpHpe9.jpg 1100w, https://miro.medium.com/v2/resize:fit:1400/0*gHGR_yB_PjfpHpe9.jpg 1400w" />
                                                    <img alt="" class="bh md nj c" height="401" loading="eager"
                                                        role="presentation" width="700" />
                                                </picture>
                                            </div>
                                        </div>
                                    </figure>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="b1d3">In this notebook, I will build a robust <code
                                            class="cx oi oj ok ol b">Natural-Language to SQL</code> Process using <a
                                            class="af om" href="https://substrate.run" rel="noopener ugc nofollow"
                                            target="_blank">Substrates</a> <code
                                            class="cx oi oj ok ol b">ComputeJSON()</code> feature.</p>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="0e31">This will generate Syntactically + Contextually Correct Queries by
                                        manually building out:</p>
                                    <ul class="">
                                        <li class="nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh on oo op bk"
                                            id="eeaf">Mappings of the SQL Table you are querying</li>
                                        <li class="nk nl gu nm b nn oq np nq nr or nt nu nv os nx ny nz ot ob oc od ou of og oh on oo op bk"
                                            id="630e">NLP Style SQL Objects that you will put together to create an SQL
                                            Syntax for the Large Language Model to reference.</li>
                                    </ul>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="3347">To use this Script all you need is a substrate.run account + api key
                                        <code class="cx oi oj ok ol b">($50 in free credits on sign up)</code>
                                    </p>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="ff7e">please reach to <a class="af om" href="http://connorbell.dev"
                                            rel="noopener ugc nofollow" target="_blank">connor bell</a> for any
                                        questions or suggestions or email me <a class="af om"
                                            href="mailto:connor.m.bell13@gmail.com" rel="noopener ugc nofollow"
                                            target="_blank">here</a>.</p>
                                    <h2 class="ov ow gu bf ox oy oz dy pa pb pc ea pd nv pe pf pg nz ph pi pj od pk pl pm pn bk"
                                        id="2c53">SQL Table</h2>
                                    <figure class="pp pq pr ps pt ne mw mx paragraph-image">
                                        <div class="nf ng fj nh bh ni" role="button" tabindex="0">
                                            <div class="mw mx po">
                                                <picture>
                                                    <source
                                                        sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"
                                                        srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*V1eXWXQWTSwIglRiLkGQ_A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*V1eXWXQWTSwIglRiLkGQ_A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*V1eXWXQWTSwIglRiLkGQ_A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*V1eXWXQWTSwIglRiLkGQ_A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*V1eXWXQWTSwIglRiLkGQ_A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*V1eXWXQWTSwIglRiLkGQ_A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V1eXWXQWTSwIglRiLkGQ_A.png 1400w"
                                                        type="image/webp" />
                                                    <source data-testid="og"
                                                        sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"
                                                        srcset="https://miro.medium.com/v2/resize:fit:640/1*V1eXWXQWTSwIglRiLkGQ_A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*V1eXWXQWTSwIglRiLkGQ_A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*V1eXWXQWTSwIglRiLkGQ_A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*V1eXWXQWTSwIglRiLkGQ_A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*V1eXWXQWTSwIglRiLkGQ_A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*V1eXWXQWTSwIglRiLkGQ_A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*V1eXWXQWTSwIglRiLkGQ_A.png 1400w" />
                                                    <img alt="" class="bh md nj c" height="250" loading="lazy"
                                                        role="presentation" width="700" />
                                                </picture>
                                            </div>
                                        </div>
                                    </figure>
                                    <h1 class="pu ow gu bf ox pv pw px pa py pz qa pd qb qc qd qe qf qg qh qi qj qk ql qm qn bk"
                                        id="6858">Setting Environment</h1>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn qo np nq nr qp nt nu nv qq nx ny nz qr ob oc od qs of og oh gn bk"
                                        id="86b8">First, I set up my development environment by installing the necessary
                                        Python packages.</p>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="e566">I made sure that the required libraries, such as ‘Pydantic’ and
                                        ‘Substrate’, were correctly installed to avoid any issues during the development
                                        process.</p>
                                    <pre
                                        class="pp pq pr ps pt qt ol qu bp qv bb bk"><span class="qw ow gu ol b bg qx qy l qz ra" id="c592">!pip install pydantic<br/>!pip install substrate<br/>from substrate import ComputeJSON, Substrate<br/>from pydantic import BaseModel, Field, validator<br/>from typing import Optional, Union, List<br/><br/>key = "apik_XXXXXXXXXXXXXX"<br/>substrate = Substrate(api_key=key)</span></pre>
                                    <h1 class="pu ow gu bf ox pv pw px pa py pz qa pd qb qc qd qe qf qg qh qi qj qk ql qm qn bk"
                                        id="4535">Step 1: Defining Column Types + Enumerations</h1>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn qo np nq nr qp nt nu nv qq nx ny nz qr ob oc od qs of og oh gn bk"
                                        id="3dcc">To start, I defined enumerations for <strong
                                            class="nm gv">dept_id</strong> and <strong class="nm gv">expertise</strong>.
                                        This step was crucial as it allowed me to restrict the possible values for these
                                        fields, ensuring that only valid options are used in SQL queries.</p>
                                    <pre
                                        class="pp pq pr ps pt qt ol qu bp qv bb bk"><span class="qw ow gu ol b bg qx qy l qz ra" id="0614">from enum import Enum<br/><br/>class Departments(str, Enum):<br/>    IT = "IT"<br/>    SALES = "SALES"<br/>    ACCOUNTING = "ACCOUNTING"<br/>    CEO = "CEO"<br/><br/>class EmpLevel(str, Enum):<br/>    JUNIOR = "JUNIOR"<br/>    SEMISENIOR = "SEMISENIOR"<br/>    SENIOR = "SENIOR"<br/><br/>class column_names(str, Enum):<br/>    EMPLOYEE_ID = "employee_id"<br/>    FIRST_NAME = "first_name"<br/>    LAST_NAME = "last_name"<br/>    DEPT_ID = "dept_id"<br/>    MANAGER_ID = "manager_id"<br/>    SALARY = "salary"<br/>    EXPERTISE = "expertise"<br/>    <br/>class TableColumns(BaseModel):<br/>    employee_id: Optional[int] = Field(None, title="Employee ID", description="The ID of the employee")<br/>    first_name: Optional[str] = Field(None, title="First Name", description="The first name of the employee")<br/>    last_name: Optional[str] = Field(None, title="Last Name", description="The last name of the employee")<br/>    dept_id: Optional[Departments] = Field(None, title="Department ID", description="The department ID of the employee")<br/>    manager_id: Optional[int] = Field(None, title="Manager ID", description="The ID of the manager")<br/>    salary: Optional[int] = Field(None, title="Salary", description="The salary of the employee")<br/>    expertise: Optional[EmpLevel] = Field(None, title="Expertise Level", description="The expertise level of the employee")</span></pre>
                                    <h1 class="pu ow gu bf ox pv pw px pa py pz qa pd qb qc qd qe qf qg qh qi qj qk ql qm qn bk"
                                        id="bb3f">Step 2: Defining SQL Syntax through Models</h1>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn qo np nq nr qp nt nu nv qq nx ny nz qr ob oc od qs of og oh gn bk"
                                        id="060f">I defined models to describe SQL <code
                                            class="cx oi oj ok ol b">operations</code>, <code
                                            class="cx oi oj ok ol b">comparisons</code>, <code
                                            class="cx oi oj ok ol b">logic operators</code>, and <code
                                            class="cx oi oj ok ol b">ordering</code>.</p>
                                    <blockquote class="rb rc rd">
                                        <p class="nk nl re nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                            id="038d">This approach ensures that SQL queries adhere to the correct
                                            format and data types, Allowing <a class="af om" href="http://substrate.run"
                                                rel="noopener ugc nofollow" target="_blank">Substrate</a> to have access
                                            to the base SQL Language when generating the JSON</p>
                                    </blockquote>
                                    <pre
                                        class="pp pq pr ps pt qt ol qu bp qv bb bk"><span class="qw ow gu ol b bg qx qy l qz ra" id="77bd">class sql_type(str, Enum):<br/>    SELECT = "SELECT"<br/>    INSERT = "INSERT"<br/>    UPDATE = "UPDATE"<br/>    DELETE = "DELETE"<br/><br/>class sql_compare(str, Enum):<br/>    EQUAL = "="<br/>    NOT_EQUAL = "!="<br/>    GREATER = "&gt;"<br/>    LESS = "&lt;"<br/>    GREATER_EQUAL = "&gt;="<br/>    LESS_EQUAL = "&lt;="<br/><br/>class sql_logic_operator(str, Enum):<br/>    AND = "AND"<br/>    OR = "OR"<br/><br/>class sql_order(str, Enum):<br/>    ASC = "ASC"<br/>    DESC = "DESC"</span></pre>
                                    <h1 class="pu ow gu bf ox pv pw px pa py pz qa pd qb qc qd qe qf qg qh qi qj qk ql qm qn bk"
                                        id="e04c">Step 4: Combining SQL Conditions with Logic Operators</h1>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn qo np nq nr qp nt nu nv qq nx ny nz qr ob oc od qs of og oh gn bk"
                                        id="a9b2">With the enumerations and validation models in place, I moved on to
                                        constructing SQL queries.</p>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="4260">I developed a function to dynamically build SQL queries based on the
                                        validated data from models. This method offers several key benefits:</p>
                                    <ul class="">
                                        <li class="nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh on oo op bk"
                                            id="2185"><code class="cx oi oj ok ol b">Security:</code> By leveraging
                                            predefined enumerations and data validations, the approach helps prevent
                                            errors and vulnerabilities in the queries.</li>
                                        <li class="nk nl gu nm b nn oq np nq nr or nt nu nv os nx ny nz ot ob oc od ou of og oh on oo op bk"
                                            id="830a"><code class="cx oi oj ok ol b">Accuracy:</code> The function
                                            ensures that the generated SQL queries are correctly formatted and adhere to
                                            the expected criteria.</li>
                                    </ul>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="8795">In essence, this step integrates the validated data into
                                        well-structured SQL queries, combining conditions and logic operators
                                        effectively.</p>
                                    <pre
                                        class="pp pq pr ps pt qt ol qu bp qv bb bk"><span class="qw ow gu ol b bg qx qy l qz ra" id="85d4">from pydantic import BaseModel, Field, validator<br/>from typing import Union<br/><br/>class sql_comparison(BaseModel):<br/>    column: column_names = Field(..., title="Table Column", description="Column in the Table")<br/>    compare: sql_compare = Field(..., title="Comparison Operator", description="Comparison Operator")<br/>    value: Union[str, Departments, EmpLevel] = Field(..., title="Value", description="Value to Compare")<br/>    <br/>class sql_logic_condition(BaseModel):<br/>    logic: sql_logic_operator = Field(..., title="Logic Operator", description="Logic Operator")<br/>    comparison: sql_comparison = Field(..., title="Comparison", description="Comparison")<br/><br/>class SQLQuery(BaseModel):<br/>    sql: sql_type = Field(..., title="SQL Type", description="SQL Type")<br/>    columns: list[column_names] = Field(..., title="Columns", description="Columns to Select")<br/>    table: str = Field(..., title="Table", description="Table Name")<br/>    conditions: List[sql_logic_condition] = Field(..., title="Conditions", description="List of Conditions with Logic")<br/>    order: Optional[sql_order] = Field(None, title="Order", description="Order")<br/>    limit: Optional[int] = Field(None, title="Limit", description="Limit")</span></pre>
                                    <h1 class="pu ow gu bf ox pv pw px pa py pz qa pd qb qc qd qe qf qg qh qi qj qk ql qm qn bk"
                                        id="e965">Step 5: Query Substrate endpoint to create SQL JSON Structure</h1>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn qo np nq nr qp nt nu nv qq nx ny nz qr ob oc od qs of og oh gn bk"
                                        id="e82b">Now that our <strong class="nm gv"><em
                                                class="re">SQLQuery</em></strong> class has been fully built out, we are
                                        ready to start hitting <a class="af om" href="http://substrate.run"
                                            rel="noopener ugc nofollow" target="_blank">Substrate</a> through their
                                        <strong class="nm gv">ComputeJSON</strong>() endpoint for generation.
                                    </p>
                                    <ol class="">
                                        <li class="nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh rf oo op bk"
                                            id="9034">We first enter out question, in this case I wanted to show the
                                            chaining of comparison statements.</li>
                                        <li class="nk nl gu nm b nn oq np nq nr or nt nu nv os nx ny nz ot ob oc od ou of og oh rf oo op bk"
                                            id="1ae5">We then create our run shown as <strong class="nm gv"><em
                                                    class="re">a</em></strong> where we are defining what we want
                                            substrate to do.</li>
                                        <li class="nk nl gu nm b nn oq np nq nr or nt nu nv os nx ny nz ot ob oc od ou of og oh rf oo op bk"
                                            id="8e02">Then kick-off the run by simply calling <strong class="nm gv"><em
                                                    class="re">substrate.run(a)</em></strong></li>
                                        <li class="nk nl gu nm b nn oq np nq nr or nt nu nv os nx ny nz ot ob oc od ou of og oh rf oo op bk"
                                            id="6725">Wait for the completion, before getting the <strong
                                                class="nm gv">json_object</strong></li>
                                        <li class="nk nl gu nm b nn oq np nq nr or nt nu nv os nx ny nz ot ob oc od ou of og oh rf oo op bk"
                                            id="55f4">Finally, we format the response as a <strong
                                                class="nm gv">SQLQuery</strong> object</li>
                                    </ol>
                                    <pre
                                        class="pp pq pr ps pt qt ol qu bp qv bb bk"><span class="qw ow gu ol b bg qx qy l qz ra" id="e057">question = "can you provide me with the the amount of employee id and salary in the Account department that has a salary greater than 50000 in descending order?"<br/>a = ComputeJSON(<br/>    prompt=question,<br/>    json_schema=SQLQuery.model_json_schema(),<br/>)<br/>res = substrate.run(a)<br/>res_json = res.get(a).json_object<br/>query_formatted = SQLQuery(**res_json)<br/>res_json</span></pre>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="96a3">We now have our query!!!</p>
                                    <pre
                                        class="pp pq pr ps pt qt ol qu bp qv bb bk"><span class="qw ow gu ol b bg qx qy l qz ra" id="60b9">{'sql': 'SELECT',<br/> 'columns': ['employee_id', 'salary'],<br/> 'table': 'employees',<br/> 'conditions': [{'logic': 'AND',<br/>   'comparison': {'column': 'dept_id', 'compare': '=', 'value': 'ACCOUNTING'}},<br/>  {'logic': 'AND',<br/>   'comparison': {'column': 'salary', 'compare': '&gt;', 'value': '50000'}}],<br/> 'order': 'DESC',<br/> 'limit': None}</span></pre>
                                    <h1 class="pu ow gu bf ox pv pw px pa py pz qa pd qb qc qd qe qf qg qh qi qj qk ql qm qn bk"
                                        id="ec3d">Step 6: Formatting Query Response</h1>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn qo np nq nr qp nt nu nv qq nx ny nz qr ob oc od qs of og oh gn bk"
                                        id="02cb">With the <strong class="nm gv"><em class="re">SQLQuery</em></strong>
                                        object ready, we construct the SQL string by parsing and combining its
                                        components into the proper SQL format.</p>
                                    <pre
                                        class="pp pq pr ps pt qt ol qu bp qv bb bk"><span class="qw ow gu ol b bg qx qy l qz ra" id="079f"># Generate the initial Base Query with no comparisons<br/>generated_query = f"{query_formatted.sql} {', '.join([col.value for col in query_formatted.columns])} FROM {query_formatted.table}"<br/><br/># Check for additional conditions<br/>if query_formatted.conditions:<br/>    # Replace first logical operator with WHERE<br/>    generated_query += " WHERE "<br/><br/>    # For each condition, append it the query in the correct format<br/>    for i, condition in enumerate(query_formatted.conditions):<br/>        if i &gt; 0:<br/>            generated_query += f" {condition.logic} "<br/>        generated_query += f"{condition.comparison.column} {condition.comparison.compare} {condition.comparison.value}"<br/><br/># if there is an ordering rule, then format and append<br/>if query_formatted.order:<br/>    generated_query += f" ORDER BY {', '.join([col.value for col in query_formatted.columns])} {query_formatted.order}"<br/><br/># if there is a limit, then format and append<br/>if query_formatted.limit:<br/>    generated_query += f" LIMIT {query_formatted.limit}"<br/><br/><br/>generated_query</span></pre>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="dd16">FINAL QUERY</p>
                                    <pre
                                        class="pp pq pr ps pt qt ol qu bp qv bb bk"><span class="qw ow gu ol b bg qx qy l qz ra" id="a967">SELECT employee_id, salary <br/>FROM employees <br/>WHERE dept_id = ACCOUNTING <br/>AND salary &gt; 50000 <br/>ORDER BY employee_id, salary DESC</span></pre>
                                    <h1 class="pu ow gu bf ox pv pw px pa py pz qa pd qb qc qd qe qf qg qh qi qj qk ql qm qn bk"
                                        id="f0d1">Next Steps</h1>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn qo np nq nr qp nt nu nv qq nx ny nz qr ob oc od qs of og oh gn bk"
                                        id="bde6">I will continue to add to this to:</p>
                                    <ul class="">
                                        <li class="nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh on oo op bk"
                                            id="ed77">allow for azure/gcp sql exporting and auto mapping ability.</li>
                                        <li class="nk nl gu nm b nn oq np nq nr or nt nu nv os nx ny nz ot ob oc od ou of og oh on oo op bk"
                                            id="b376">Change Sql mapping to allow for nested Queries</li>
                                    </ul>
                                    <h1 class="pu ow gu bf ox pv pw px pa py pz qa pd qb qc qd qe qf qg qh qi qj qk ql qm qn bk"
                                        id="fbdf">Conclusion</h1>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn qo np nq nr qp nt nu nv qq nx ny nz qr ob oc od qs of og oh gn bk"
                                        id="2c05">My team has encountered consistent issues with SQL generation through
                                        LLM’s. The primary challenge isn’t related to formatting but rather to context.
                                    </p>
                                    <blockquote class="rb rc rd">
                                        <p class="nk nl re nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                            id="4536">Even with optimized prompt structures that include all necessary
                                            rows and context, we still end up consuming excessive tokens for even the
                                            simplest queries. The `ComputeJSON()` function does not count the
                                            `json_schema` as ingested tokens</p>
                                    </blockquote>
                                    <p class="pw-post-body-paragraph nk nl gu nm b nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh gn bk"
                                        id="3937">Our strategy, which focuses on minimizing the context required in
                                        prompts, has proven to be effective. By solely including the query itself and
                                        eliminating external context, we have significantly reduced token usage by over
                                        90%.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </article>
</body>

</html>